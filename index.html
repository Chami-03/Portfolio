<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Chamikara Wijerathne - Aspiring Business Analyst · Data Analyst</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
  <style>
    :root{
      --bg: #f5f7fb;
      --card: #ffffff;
      --text: #111827;
      --muted: #6b7280;
      --accent:  #0ea5a4;
      --glass: rgba(255,255,255,0.55);
      --shadow-soft: 12px 12px 24px rgba(15,23,42,0.06), -8px -8px 18px rgba(255,255,255,0.6);
      --neo-shadow: 14px 14px 30px rgba(16,24,40,0.08), -10px -10px 20px rgba(255,255,255,0.9);
      --glass-border: rgba(255,255,255,0.5);
      --glass-blur: 10px;
      --icon-color: #111827;
    }

    [data-theme='dark']{
      --bg: #0b1220;
      --card: rgba(18,22,30,0.6);
      --text: #e6eef6;
      --muted: #9aa6b2;
      --accent: #4dd6d4;
      --glass: rgba(255,255,255,0.04);
      --shadow-soft: 12px 12px 30px rgba(0,0,0,0.6), -8px -8px 18px rgba(255,255,255,0.02);
      --neo-shadow: inset 6px 6px 12px rgba(0,0,0,0.6), inset -6px -6px 12px rgba(255,255,255,0.02);
      --glass-border: rgba(255,255,255,0.06);
      --glass-blur: 8px;
      --icon-color: #e6eef6;
    }

    /* Base Styling & Reset */
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg,var(--bg), color-mix(in srgb, var(--bg) 85%, #000 15%));
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      transition: background .45s ease, color .3s ease;
      overflow-x:hidden;
    }

    /* Utility classes */
    .wrap{max-width:1100px;margin:48px auto;padding:0 32px;}
    section{margin-top:48px}

    /* Header & Navigation */
    header{
      position:fixed;left:50%;transform:translateX(-50%);top:18px;width:calc(100% - 64px);max-width:1100px;z-index:40
    }

    .nav{
      display:flex;align-items:center;justify-content:space-between;background:var(--glass);
      padding:10px 14px;border-radius:14px;backdrop-filter:blur(var(--glass-blur));border:1px solid var(--glass-border);
      box-shadow:var(--shadow-soft);
      transition: background .3s ease;
    }

    .brand{display:flex;gap:14px;align-items:center}
    .logo{
      width:52px;height:52px;border-radius:12px;display:grid;place-items:center;font-weight:700;background:linear-gradient(135deg,var(--accent),#6b21a8);color:white;box-shadow:var(--neo-shadow);
    }
    .brand h1{font-size:16px;margin:0}
    .brand p{font-size:12px;margin:0;color:var(--muted)}

    nav ul{display:flex;gap:12px;list-style:none;margin:0;padding:0}
    nav a{padding:8px 12px;border-radius:10px;text-decoration:none;color:var(--text);font-weight:600;transition:all .2s ease}
    nav a:hover{background:color-mix(in srgb, var(--accent) 12%, transparent);transform:translateY(-3px)}

    .controls{display:flex;gap:8px;align-items:center}
    .toggle{display:inline-grid;place-items:center;width:38px;height:38px;background:transparent;border-radius:10px;border:1px solid var(--glass-border);cursor:pointer}
    .toggle svg{width:20px;height:20px;stroke:var(--icon-color)}

    .menu-toggle{display:none;width:38px;height:38px;border-radius:10px;border:1px solid var(--glass-border);cursor:pointer;background:transparent;align-items:center;justify-content:center;color:var(--icon-color)}
    .menu-toggle svg{stroke:var(--icon-color)}


    /* Hero */
    .hero{
      display:grid;
      grid-template-columns:1fr 420px;
      gap:38px;
      align-items:center;
      margin-top:150px; 
    }
    .hero-left{padding:28px;border-radius:14px;background:var(--card);box-shadow:var(--shadow-soft);backdrop-filter:blur(var(--glass-blur));border:1px solid var(--glass-border); transition: background .3s ease;}

    .intro{font-size:14px;color:var(--muted);margin-bottom:8px}
    h2.name{font-size:34px;margin:6px 0 10px;letter-spacing:-0.5px}
    p.lead{margin:0 0 18px;line-height:1.5;color:var(--muted)}

    .cta{display:flex;gap:12px}
    .btn{padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:700;transition:all .3s ease}
    .btn.primary{background:linear-gradient(90deg,var(--accent),#6b21a8);color:white;box-shadow:0 8px 30px rgba(14,165,164,0.14);}
    .btn.ghost{background:transparent;border:1px solid rgba(0,0,0,0.06);color:var(--text)}

    .cards{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-top:18px}
    .card{padding:12px;border-radius:12px;background:var(--glass);border:1px solid var(--glass-border);box-shadow:var(--neo-shadow); transition: background .3s ease;}
    .card strong {font-size: 14px;}
    .card div {font-size: 11px !important;} 


    /* Right column: low image + 3D canvas */
    .canvas-wrap{position:relative;border-radius:14px;overflow:hidden;min-height:360px;display:grid;grid-template-rows:1fr auto;background:linear-gradient(135deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));border:1px solid var(--glass-border);backdrop-filter:blur(var(--glass-blur))}
    #threejs-canvas{width:100%;height:100%;display:block}
    .avatar{padding:16px;display:flex;gap:12px;align-items:center}
    .avatar svg{width:56px;height:56px;border-radius:10px}

    /* Projects */
    .projects-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px}
    .project{padding:18px;border-radius:12px;background:var(--card);box-shadow:var(--shadow-soft);border:1px solid var(--glass-border);transition:transform .35s cubic-bezier(.2,.9,.3,1)}
    .project:hover{transform:translateY(-4px) scale(1.005)}

    .neo{
      padding:20px;
      border-radius:16px;
      background:var(--card);
      box-shadow: 8px 8px 20px rgba(2,6,23,0.06), -8px -8px 20px rgba(255,255,255,0.8);
      transition: background .3s ease;
    }
    .neo a{color:var(--accent)}

    footer{margin:56px 0 28px;padding-bottom: 20px;text-align:center;color:var(--muted)}

    /* Scroll animations */
    .reveal{opacity:0;transform:translateY(14px) scale(.995);transition:opacity .6s ease, transform .6s cubic-bezier(.2,.9,.3,1)}
    .reveal.visible{opacity:1;transform:none}

    /* -------------------------------------- */
    /* NEW CHATBOT STYLES */
    /* -------------------------------------- */
    #chat-overlay {
      position: fixed;
      bottom: 25px;
      right: 25px;
      width: 360px;
      height: 480px;
      background: var(--card);
      border-radius: 16px;
      box-shadow: var(--shadow-soft);
      border: 1px solid var(--glass-border);
      display: flex;
      flex-direction: column;
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
      transform: translateY(20px) scale(0.95);
      transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
      backdrop-filter: blur(var(--glass-blur));
    }

    #chat-overlay.active {
      opacity: 1;
      pointer-events: all;
      transform: translateY(0) scale(1);
    }

    .chat-header {
      padding: 16px;
      background: color-mix(in srgb, var(--accent) 15%, transparent);
      border-bottom: 1px solid var(--glass-border);
      border-radius: 16px 16px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .chat-header h4 { margin: 0; font-size: 15px; color: var(--accent); }
    .chat-close { background: none; border: none; font-size: 20px; color: var(--muted); cursor: pointer; }

    .chat-messages {
      flex: 1;
      padding: 16px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 12px;
      font-size: 13px;
    }

    .message {
      padding: 10px 14px;
      border-radius: 12px;
      max-width: 80%;
      line-height: 1.4;
    }

    .message.bot {
      background: color-mix(in srgb, var(--muted) 10%, transparent);
      color: var(--text);
      align-self: flex-start;
      border-bottom-left-radius: 2px;
    }

    .message.user {
      background: var(--accent);
      color: white;
      align-self: flex-end;
      border-bottom-right-radius: 2px;
    }

    .chat-input-area {
      padding: 12px;
      border-top: 1px solid var(--glass-border);
      display: flex;
      gap: 8px;
    }

    .chat-input {
      flex: 1;
      background: transparent;
      border: 1px solid var(--glass-border);
      border-radius: 8px;
      padding: 8px 12px;
      color: var(--text);
      font-family: inherit;
    }
    .chat-input:focus { outline: 2px solid var(--accent); border-color: transparent; }

    .chat-send {
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 0 16px;
      font-weight: 600;
      cursor: pointer;
    }

    @media (max-width: 640px) {
      #chat-overlay {
        width: 100%; height: 100%; bottom: 0; right: 0; border-radius: 0;
      }
      .chat-header { border-radius: 0; }
    }


    /* RESPONSIVE DESIGN - MEDIA QUERIES */
    @media (max-width: 1024px) {
      .wrap { padding: 0 24px; margin: 36px auto; }
      header { width: calc(100% - 48px); top: 12px; }
      .hero { grid-template-columns: 1fr; gap: 24px; margin-top: 110px; }
      .canvas-wrap { min-height: 320px; }
      h2.name { font-size: 30px; }
      .projects-grid { grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); }
      .cards { grid-template-columns: repeat(3, 1fr); } 
      .intro { font-size: 13px; }
      nav ul { gap: 8px; }
      nav a { padding: 8px; }
    }

    @media (max-width: 640px) {
      .wrap { padding: 0 16px; margin: 24px auto; }
      header { width: calc(100% - 32px); top: 10px; }
      h2.name { font-size: 26px; }
      .hero-left{padding: 18px;}
      .logo { width: 44px; height: 44px; font-size: 14px; }
      .brand { gap: 10px; }
      .brand h1 { font-size: 14px; }
      .brand p { font-size: 10px; }
      .canvas-wrap { min-height: 240px; }
      .avatar { padding: 12px; gap: 10px; }
      .avatar svg { width: 48px; height: 48px; }
      .hero { margin-top: 110px; } 
      .intro { font-size: 12px; } 

      .nav {
        display: grid;
        grid-template-columns: auto 1fr auto; 
        gap: 10px;
        align-items: center;
      }
      
      .brand { grid-column: 1 / 2; }
      .controls { grid-column: 3 / 4; gap: 4px; }
      
      nav {
        grid-column: 1 / -1; 
        order: 2; 
        display: none; 
        width: 100%;
      }

      nav ul {
        display: none; 
        flex-direction: column;
        width: 100%;
        margin-top: 10px; 
        background: color-mix(in srgb, var(--card) 95%, transparent);
        border-top: 1px solid var(--glass-border);
        padding: 10px 0;
        border-radius: 0 0 14px 14px;
        box-shadow: var(--shadow-soft);
        backdrop-filter: blur(var(--glass-blur));
      }

      .nav.menu-open nav { display: block; }
      .nav.menu-open nav ul {
        display: flex;
        border: 1px solid var(--glass-border);
        border-top: none;
      }

      nav ul li { width: 100%; }
      nav a { padding: 12px 18px; display: block; }
      .menu-toggle { display: flex; }
      .cards { grid-template-columns: 1fr; } 
      .cta { flex-direction: column; gap: 8px; }

      .neo {
        flex-direction: column;
        align-items: flex-start !important;
      }
      .neo > div:last-child {
        margin-top: 12px;
        width: 100%;
        justify-content: space-between;
      }
      .neo .btn.primary { margin-left: 0; flex-grow: 1; }
    }

    @media (min-width: 641px) {
        .nav { grid-template-columns: auto 1fr auto; } 
        nav { 
            display: flex !important; 
            grid-column: 2 / 3; 
            justify-content: flex-end; 
        }
        .controls { grid-column: 3 / 4; }
        .menu-toggle { display: none; }
        nav ul { display: flex !important; }
    }
  </style>
</head>
<body data-theme="light">
  <header>
    <div class="nav" id="mainNav">
      <div class="brand">
        <div class="logo" aria-hidden>CW</div>
        <div>
          <h1 style="margin:0;font-size:14px">Chamikara Wijerathne</h1>
          <p style="margin:0;font-size:11px;color:var(--muted)">Aspiring Business Analyst · Data Analyst</p>
        </div>
      </div>
      
      <nav>
        <ul>
          <li><a href="#about">About</a></li>
          <li><a href="#projects">Projects</a></li>
          <li><a href="#contact">Contact</a></li>
        </ul>
      </nav>
      
      <div class="controls">
        <button class="toggle" id="themeToggle" aria-label="Toggle theme">
          <svg class="sun-icon" style="display:none;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
          <svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
        </button>
        <button class="menu-toggle" id="menuToggle" aria-label="Toggle menu">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
        </button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div class="hero">
      <div class="hero-left">
        <div class="intro">Hello - I’m an IT undergraduate focused on data, and systems analysis</div>
        <h2 class="name">Chamikara Wijerathne</h2>
        <p class="lead">BSc (Hons) in Information Technology Specialising in Information Systems Engineering. 2nd year (since 2024). I turn product questions into clear requirements and data insights. Skills: requirements elicitation, SQL analysis, system design, and teamwork.</p>

        <div class="cta">
          <button class="btn primary" id="downloadResume">Resume</button>
          <button class="btn ghost" id="openAssistant">AI Assistant</button>
        </div>

        <div class="cards" style="margin-top:18px">
          <div class="card reveal"><strong>Aspiring BA</strong><div style="font-size:12px;color:var(--muted)">Requirements · SRS · User flows</div></div>
          <div class="card reveal"><strong>Aspiring DA</strong><div style="font-size:12px;color:var(--muted)">SQL · Power BI · Excel</div></div>
          <div class="card reveal"><strong>Stack</strong><div style="font-size:12px;color:var(--muted)">Java · Spring Boot · Git</div></div>
        </div>

      </div>

      <aside class="canvas-wrap">
        <canvas id="threejs-canvas"></canvas>
        <div class="avatar neo" style="align-items:center">
          <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="64" height="64" rx="12" fill="url(#g)"/><defs><linearGradient id="g" x1="0" x2="1"><stop offset="0" stop-color="#0ea5a4"/><stop offset="1" stop-color="#6b21a8"/></linearGradient></defs></svg>
          <div style="flex:1">
            <div style="font-weight:700">Skill Cube</div>
            <div style="font-size:12px;color:var(--muted)">Interactive • Hover or drag to rotate. Click face to see a short note.</div>
          </div>
        </div>
      </aside>
    </div>

    <section id="about" class="reveal">
      <h3 style="margin:0 0 12px">About</h3>
      <p class="lead" style="margin:0 0 18px">I specialise in clarifying product problems and turning them into measurable solutions. I balance system-level thinking (back-end fundamentals) with practical analysis (SQL, Excel, Power BI). Open for internships in BA/DA and collaborative university projects.</p>
    </section>

    <section id="projects" class="reveal">
      <h3 style="margin:0 0 12px">Selected Projects</h3>
      <div class="projects-grid">
        <article class="project reveal">
          <h4 style="margin:0 0 6px">Tutor Management System - OOP Module (SLIIT)</h4>
          <p style="margin:0 0 12px;color:var(--muted);font-size:13px">A full-stack tutor management app built to demonstrate Java OOP and layered architecture. Focus: reliable CRUD flows, student registration, session scheduling and feedback capture — designed with clear domain models & service layers.</p>
          <small style="color:var(--muted)">Spring Boot · Java · HTML/CSS/JS</small>
          <div style="margin-top:10px"><a href="https://github.com/Chami-03/TuitionConnect" target="_blank" rel="noopener" style="color:var(--accent);font-weight:600">View on GitHub →</a></div>
        </article>

        <article class="project reveal">
          <h4 style="margin:0 0 6px">FitVital Hub - Role-Based Health Platform</h4>
          <p style="margin:0 0 12px;color:var(--muted);font-size:13px">Team-built platform with role-based dashboards (Admin, Doctor, Dietician, Patient). Implemented secure file uploads, payment integration, and notification flows. Emphasis on clean service patterns and normalized DB design.</p>
          <small style="color:var(--muted)">Java · Spring Boot · MySQL · JPA</small>
          <div style="margin-top:10px"><a href="https://github.com/Chami-03/FitVitalHub" target="_blank" rel="noopener" style="color:var(--accent);font-weight:600">View on GitHub →</a></div>
        </article>

        <article class="project reveal">
          <h4 style="margin:0 0 6px">Mobile Banking Redesign - UX & BA Sample</h4>
          <p style="margin:0 0 12px;color:var(--muted);font-size:13px">A BA-style case study: requirement elicitation, user journeys, and measurable KPIs. Produced SRS, flow diagrams and recommended UI changes to improve task completion and reduce user errors.</p>
          <small style="color:var(--muted)">Figma · SRS · User Flows</small>
          <div style="margin-top:10px"><a href="https://github.com/sample/mobile-banking-redesign" target="_blank" rel="noopener" style="color:var(--accent);font-weight:600">View on GitHub →</a></div>
        </article>
      </div>
    </section>

    <section id="education" class="reveal">
      <h3 style="margin:0 0 12px">Education</h3>
      <div class="project reveal" style="padding:18px;margin-bottom:12px">
        <h4 style="margin:0 0 6px">BSc (Hons) in Information Technology - Specialising in Information Systems Engineering</h4>
        <p style="margin:0;color:var(--muted);font-size:13px">Sri Lanka Institute of Information Technology (SLIIT) - 2nd year (since 2024)</p>
      </div>
      <h3 style="margin:0 0 12px">Skills & Tools</h3>
      <p class="skill-text" style="margin:0;color:var(--muted);font-size:13px">Business Analysis · Requirement Gathering · SQL & MySQL · Power BI (learning) · Excel · Java (Spring Boot) · Git · UML & Flow Diagrams</p>
    </section>

    <section id="contact" style="margin-top:28px" class="reveal">
      <div class="neo reveal" style="display:flex;justify-content:space-between;align-items:center;gap:12px">
        <div>
          <h4 style="margin:0 0 6px">Contact</h4>
          <p style="margin:0;color:var(--muted);font-size:13px">
            Email: <a href="mailto:chamiw.online@gmail.com">chamiw.online@gmail.com</a>
          </p>
          <p style="margin:4px 0 0;color:var(--muted);font-size:13px">
            Availability: Open for internships & collaborative projects
          </p>
        </div>

        <div style="display:flex;align-items:center;gap:12px">
          <a href="https://www.linkedin.com/in/chamikarawijerathne/" target="_blank" title="LinkedIn">
            <img 
              src="https://cdn-icons-png.flaticon.com/512/174/174857.png" 
              alt="LinkedIn"
              style="width:32px;height:32px;border-radius:6px;box-shadow:var(--neo-shadow)"
            >
          </a>

          <a href="https://github.com/Chami-03" target="_blank" title="GitHub">
            <img 
              src="https://cdn-icons-png.flaticon.com/512/25/25231.png" 
              alt="GitHub"
              style="width:32px;height:32px;border-radius:6px;box-shadow:var(--neo-shadow)"
            >
          </a>

          <button class="btn primary" style="margin-left:8px" id="hireBtn">Hire / Collab</button>
        </div>
      </div>
    </section>

    <footer>&copy; 2025 Chamikara Wijerathne. All rights reserved.</footer>
  </main>

  <div id="chat-overlay">
    <div class="chat-header">
      <h4>Chami's AI Assistant</h4>
      <button class="chat-close" id="closeChat">&times;</button>
    </div>
    <div class="chat-messages" id="chatMessages">
      <div class="message bot">
        Hi! I'm an AI assistant for Chamikara's portfolio. I read the page content to answer your questions. Ask me about projects, skills, or education!
      </div>
    </div>
    <div class="chat-input-area">
      <input type="text" class="chat-input" id="chatInput" placeholder="Ask a question..." />
      <button class="chat-send" id="sendChat">Send</button>
    </div>
  </div>

  <script>
    // Utility function to safely get style properties
    function getCssVar(name) {
      return getComputedStyle(document.documentElement).getPropertyValue(name).trim();
    }

    // Theme toggle with smooth transitions and persisted preference
    const body = document.body;
    const themeToggle = document.getElementById('themeToggle');
    const sunIcon = themeToggle.querySelector('.sun-icon');
    const moonIcon = themeToggle.querySelector('.moon-icon');

    const savedTheme = localStorage.getItem('cw_theme');
    if(savedTheme) body.setAttribute('data-theme', savedTheme);

    function updateIcons(theme) {
        if (theme === 'dark') {
            sunIcon.style.display = 'block';
            moonIcon.style.display = 'none';
        } else {
            sunIcon.style.display = 'none';
            moonIcon.style.display = 'block';
        }
    }
    // Initial icon update
    updateIcons(body.getAttribute('data-theme'));

    themeToggle.addEventListener('click', ()=>{
      const currentTheme = body.getAttribute('data-theme');
      const nextTheme = currentTheme === 'dark' ? 'light':'dark';
      body.setAttribute('data-theme', nextTheme);
      updateIcons(nextTheme);
      localStorage.setItem('cw_theme', nextTheme);
    });
    
    // Mobile Menu Toggle
    const menuToggle = document.getElementById('menuToggle');
    const mainNav = document.getElementById('mainNav');
    menuToggle.addEventListener('click', () => {
        mainNav.classList.toggle('menu-open');
    });
    // Close menu when a link is clicked
    document.querySelectorAll('#mainNav nav a').forEach(link => {
        link.addEventListener('click', () => {
            if (mainNav.classList.contains('menu-open')) {
                mainNav.classList.remove('menu-open');
            }
        });
    });

    // Simple reveal on scroll
    const reveals = document.querySelectorAll('.reveal');
    const io = new IntersectionObserver((entries)=>{
      for(const e of entries){ if(e.isIntersecting) e.target.classList.add('visible'); }
    },{threshold:.12});
    reveals.forEach(r=>io.observe(r));

    // 3D rotating cube (persists original feel)
    (function(){
      const canvas = document.getElementById('threejs-canvas');
      if (!canvas || typeof THREE === 'undefined') return;

      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(35, canvas.clientWidth/canvas.clientHeight, 0.1, 1000);
      const renderer = new THREE.WebGLRenderer({canvas, alpha:true, antialias:true});
      renderer.setPixelRatio(window.devicePixelRatio);
      
      const initialResize = () => {
          const w = canvas.clientWidth; 
          const h = canvas.clientHeight;
          renderer.setSize(w, h, false); 
          camera.aspect = w / h; 
          camera.updateProjectionMatrix();
      };
      initialResize(); 
      camera.position.z = 3.2;

      function makeFace(text){
        const c = document.createElement('canvas');
        c.width = 256; c.height = 256;
        const ctx = c.getContext('2d');
        const accentColor = getCssVar('--accent') || '#0ea5a4';
        
        ctx.fillStyle = accentColor;
        ctx.fillRect(0,0,256,256);
        ctx.fillStyle = 'white';
        ctx.font = 'bold 36px Inter, sans-serif'; 
        ctx.textAlign = 'center';
        ctx.fillText(text,128,145);
        return new THREE.CanvasTexture(c);
      }
      
      const materials = [
        new THREE.MeshStandardMaterial({map: makeFace('BA'), metalness:0.2, roughness:0.5}),
        new THREE.MeshStandardMaterial({map: makeFace('DA'), metalness:0.2, roughness:0.5}),
        new THREE.MeshStandardMaterial({map: makeFace('SQL'), metalness:0.2, roughness:0.5}),
        new THREE.MeshStandardMaterial({map: makeFace('Java'), metalness:0.2, roughness:0.5}),
        new THREE.MeshStandardMaterial({map: makeFace('Sys'), metalness:0.2, roughness:0.5}),
        new THREE.MeshStandardMaterial({map: makeFace('Viz'), metalness:0.2, roughness:0.5}),
      ];

      const geometry = new THREE.BoxGeometry(1.2,1.2,1.2);
      const cube = new THREE.Mesh(geometry, materials);
      scene.add(cube);

      const light = new THREE.DirectionalLight(0xffffff, 1.0);
      light.position.set(5,5,5); scene.add(light);
      const amb = new THREE.AmbientLight(0xffffff, .45); scene.add(amb);

      function resize(){
        const w = canvas.clientWidth; 
        const h = canvas.clientHeight;
        if(canvas.width !== w || canvas.height !== h){ 
            renderer.setSize(w,h,false); 
            camera.aspect = w/h; 
            camera.updateProjectionMatrix(); 
        }
      }
      window.addEventListener('resize', resize);

      let t=0;
      function animate(){
        resize(); t+=0.01;
        cube.rotation.x += 0.003; 
        cube.rotation.y += 0.005; 
        cube.rotation.z += 0.001;
        renderer.render(scene, camera);
        requestAnimationFrame(animate);
      }
      window.onload = animate;

      const skills = [
          'Business Analysis — Requirements, SRS, Use Cases.',
          'Data Analysis — SQL queries, aggregation, validation.',
          'Databases — MySQL design & normalization.',
          'Backend — Java & Spring Boot fundamentals.',
          'Systems — Architecture & integration thinking.',
          'Visualisation — Power BI basics, storytelling.'
      ];
      let skillIndex = 0;
      
      function showMessageBox(title, message) {
          const existingBox = document.getElementById('custom-message-box');
          if (existingBox) existingBox.remove();

          const box = document.createElement('div');
          box.id = 'custom-message-box';
          box.style.cssText = `
              position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
              background: var(--card); color: var(--text); padding: 20px; border-radius: 12px;
              box-shadow: var(--shadow-soft); z-index: 1000; max-width: 90vw; width: 350px;
              text-align: center; border: 1px solid var(--glass-border); backdrop-filter: blur(var(--glass-blur));
          `;
          box.innerHTML = `
              <h4 style="margin: 0 0 10px; font-size: 1.1em; color: var(--accent);">${title}</h4>
              <p style="margin: 0 0 15px; font-size: 0.9em;">${message}</p>
              <button id="msg-box-close" style="padding: 8px 16px; border: none; border-radius: 8px; background: var(--accent); color: white; cursor: pointer; font-weight: 600;">Close</button>
          `;
          document.body.appendChild(box);

          document.getElementById('msg-box-close').addEventListener('click', () => {
              box.remove();
          });
      }

      canvas.addEventListener('click', (e)=>{
          if (e._isDragging) return; 
          showMessageBox('Skill Focus', skills[skillIndex]);
          skillIndex = (skillIndex + 1) % skills.length;
      });
      
      let isDown=false, lastX=0, lastY=0, startX=0, startY=0;
      const DRAG_THRESHOLD = 5; 

      const handlePointerDown = (e) => { 
          const clientX = e.clientX || (e.touches && e.touches[0].clientX) || 0;
          const clientY = e.clientY || (e.touches && e.touches[0].clientY) || 0;
          isDown = true; 
          startX = lastX = clientX;
          startY = lastY = clientY;
          e.currentTarget._isDragging = false; 
          if(e.setPointerCapture) e.setPointerCapture(e.pointerId); 
      };
      const handlePointerUp = (e) => { 
          isDown=false; 
          const dx = Math.abs(lastX - startX);
          const dy = Math.abs(lastY - startY);
          if (dx > DRAG_THRESHOLD || dy > DRAG_THRESHOLD) {
              canvas._isDragging = true;
          } else {
              canvas._isDragging = false;
          }
      };
      const handlePointerMove = (e) => { 
          if(!isDown) return; 
          const clientX = e.clientX || (e.touches && e.touches[0].clientX) || 0;
          const clientY = e.clientY || (e.touches && e.touches[0].clientY) || 0;
          const dx=(clientX-lastX)/200; 
          const dy=(clientY-lastY)/200; 
          cube.rotation.y += dx; 
          cube.rotation.x += dy; 
          lastX=clientX; 
          lastY=clientY; 
          const totalDx = Math.abs(clientX - startX);
          const totalDy = Math.abs(clientY - startY);
          if (totalDx > DRAG_THRESHOLD || totalDy > DRAG_THRESHOLD) {
              canvas._isDragging = true;
          }
      };

      canvas.addEventListener('mousedown', handlePointerDown);
      window.addEventListener('mouseup', handlePointerUp);
      canvas.addEventListener('mousemove', handlePointerMove);
      canvas.addEventListener('touchstart', (e) => handlePointerDown(e), { passive: false });
      window.addEventListener('touchend', handlePointerUp);
      canvas.addEventListener('touchmove', handlePointerMove, { passive: false });
    })();

    // -----------------------------------------------------------
    // UPGRADED AI ASSISTANT: DYNAMIC PAGE SCRAPER
    // -----------------------------------------------------------
    const chatOverlay = document.getElementById('chat-overlay');
    const chatInput = document.getElementById('chatInput');
    const chatMessages = document.getElementById('chatMessages');
    const sendBtn = document.getElementById('sendChat');
    const closeChatBtn = document.getElementById('closeChat');
    const openBtn = document.getElementById('openAssistant');

    function toggleChat() {
      chatOverlay.classList.toggle('active');
      if(chatOverlay.classList.contains('active')) chatInput.focus();
    }

    function addMessage(text, sender) {
      const div = document.createElement('div');
      div.className = `message ${sender}`;
      div.innerHTML = text;
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight; 
    }

    // FUNCTION: Scrape the page to find answers
    function generateDynamicResponse(query) {
      const q = query.toLowerCase();

      // 1. PROJECTS: Dynamically find all elements with class 'project'
      if (q.includes('project') || q.includes('work') || q.includes('built') || q.includes('app')) {
        const projectElements = document.querySelectorAll('#projects .project');
        if (projectElements.length > 0) {
          let response = "Here are the projects listed on the page:<br><br>";
          projectElements.forEach((el, index) => {
            const title = el.querySelector('h4') ? el.querySelector('h4').innerText : 'Untitled Project';
            const desc = el.querySelector('p') ? el.querySelector('p').innerText : '';
            response += `<strong>${index + 1}. ${title}</strong><br>${desc}<br><br>`;
          });
          return response;
        } else {
          return "I currently don't see any projects listed in the Projects section.";
        }
      }

      // 2. SKILLS: Dynamically find the text in the skills section
      if (q.includes('skill') || q.includes('tech') || q.includes('tool') || q.includes('java') || q.includes('sql')) {
        // Try to find the specific paragraph with class .skill-text or the Education section
        const skillsText = document.querySelector('.skill-text');
        if (skillsText) {
          return "According to the Skills section:<br><br>" + skillsText.innerText;
        }
        // Fallback: search whole education section
        const eduSection = document.getElementById('education');
        if (eduSection) return "Here is the info from the Education/Skills section: " + eduSection.innerText;
      }

      // 3. ABOUT / BIO
      if (q.includes('about') || q.includes('who') || q.includes('chamikara') || q.includes('intro')) {
        const aboutSection = document.getElementById('about');
        const heroName = document.querySelector('.hero .name').innerText;
        const heroLead = document.querySelector('.hero .lead').innerText;
        
        if (aboutSection) {
          return `<strong>${heroName}</strong><br>${heroLead}<br><br><strong>More Info:</strong><br>${aboutSection.innerText.replace('About', '')}`;
        }
      }

      // 4. CONTACT / EMAIL
      if (q.includes('contact') || q.includes('email') || q.includes('hire') || q.includes('reach')) {
        const contactSection = document.getElementById('contact');
        if (contactSection) {
          // Extract email specifically if possible, otherwise dump section
          const emailLink = contactSection.querySelector('a[href^="mailto"]');
          const email = emailLink ? emailLink.innerText : "Check the footer or contact section.";
          return `You can contact Chamikara at: <strong>${email}</strong>.<br>Check the Contact section for LinkedIn/GitHub links.`;
        }
      }
      
      // 5. EDUCATION
      if (q.includes('education') || q.includes('degree') || q.includes('uni') || q.includes('study')) {
         const eduSection = document.getElementById('education');
         // Just get the first project card inside education (which holds the degree info)
         const degreeInfo = eduSection.querySelector('.project'); 
         if(degreeInfo) return degreeInfo.innerText;
         return "He is an undergraduate at SLIIT.";
      }

      // 6. GREETINGS
      if (q.includes('hi') || q.includes('hello')) {
        return "Hello! I am scanning the page content right now. Ask me about the projects, skills, or contact info listed here.";
      }

      return "I'm looking at the page, but I'm not sure how to answer that based on the current text. Try asking about 'projects', 'skills', or 'contact'.";
    }

    function handleUserMessage() {
      const text = chatInput.value.trim();
      if (!text) return;

      addMessage(text, 'user');
      chatInput.value = '';

      // Slight delay to simulate "reading"
      setTimeout(() => {
        const response = generateDynamicResponse(text);
        addMessage(response, 'bot');
      }, 500); 
    }

    openBtn.addEventListener('click', toggleChat);
    closeChatBtn.addEventListener('click', toggleChat);
    
    sendBtn.addEventListener('click', handleUserMessage);
    chatInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') handleUserMessage();
    });

    // Download resume logic
    document.getElementById('downloadResume').addEventListener('click', ()=>{
      const pdfPath = './Chamikara_Wijerathne_Resume.pdf';
      const a = document.createElement('a');
      a.href = pdfPath; 
      a.download = 'Chamikara_Wijerathne_Resume.pdf'; 
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    });

    document.getElementById('hireBtn').addEventListener('click', ()=>{
      const email = 'mailto:chamiw.online@gmail.com?subject=Collaboration%20or%20Opportunity';
      window.location.href = email;
    });
  </script>
</body>
</html>
